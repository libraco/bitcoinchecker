<!DOCTYPE html>
<html>
<head>
  <title>Bitcoin Checker - Check BTC Address Balance and Transactions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A simple tool to check Bitcoin wallet addresses and transaction hashes, view balances, and track transaction history.">
  <link rel="icon" href="https://bitcoin.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="https://bitcoin.org/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
  :root {
    --primary-color: #f7931a;
    --secondary-color: #4d4d4d;
    --background-color: #f8f9fa;
    --card-bg: #ffffff;
    --text-color: #333333;
    --border-color: #e0e0e0;
    --success-color: #28a745;
    --info-color: #17a2b8;
    --danger-color: #dc3545;
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background-color: var(--background-color);
    color: var(--text-color);
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
  }
  
  header {
    background-color: var(--primary-color);
    color: white;
    padding: 20px 0;
    text-align: center;
    border-radius: 0 0 10px 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
  }
  
  h1 {
    margin: 0;
    font-size: 2.2rem;
  }
    
      /* Responsive styles */
  @media (max-width: 768px) {
    h1 {
      font-size: 1.8rem;
    }
    
    .search-input {
      flex-direction: column;
    }
    
    button {
      width: 100%;
    }
    
    .balance-card .amount {
      font-size: 1.5rem;
    }
  }
  
  @media (max-width: 480px) {
    h1 {
      font-size: 1.5rem;
    }
    
    .container {
      padding: 10px;
    }
    
    header {
      padding: 15px 0;
    }
    
    .card {
      padding: 15px;
    }
  }
    
  .search-box {
    background-color: var(--card-bg);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
    display: flex;
    flex-direction: column;
  }
  
  .search-input {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
    
  input[type="text"] {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    font-size: 16px;
    transition: border-color 0.3s;
  }
  
  input[type="text"]:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(247, 147, 26, 0.2);
  }
  
  button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 5px;
    padding: 12px 20px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: background-color 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  button:hover {
    background-color: #e68a00;
  }
    
  .card {
    background-color: var(--card-bg);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
  }
  
  .balance-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
    
  .balance-card {
    background-color: var(--card-bg);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  .balance-card h2 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.2rem;
    color: var(--secondary-color);
  }
  
  .balance-card .icon {
    font-size: 2rem;
    margin-bottom: 15px;
  }
  
  .balance-card .amount {
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 5px;
  }
  
  .balance-card .usd-amount {
    font-size: 1rem;
    color: var(--secondary-color);
  }
    
  .balance {
    color: var(--success-color);
  }
  
  .received {
    color: var(--info-color);
  }
  
  .sent {
    color: var(--danger-color);
  }
    
  .transactions-section {
    width: 100%;
    box-sizing: border-box;
    overflow: hidden;
  }
  
  .transactions-section h2 {
    margin-top: 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    border-radius: 5px;
    table-layout: fixed;
  }
  
  .table-container {
    width: 100%;
    overflow-x: auto;
  }
    
  th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    white-space: nowrap;
  }
  
  /* Định nghĩa chiều rộng cho các cột */
  table th:nth-child(1), table td:nth-child(1) { width: 20%; } /* Date & Time */
  table th:nth-child(2), table td:nth-child(2) { width: 10%; } /* Type */
  table th:nth-child(3), table td:nth-child(3) { width: 30%; } /* Transaction ID */
  table th:nth-child(4), table td:nth-child(4) { width: 20%; } /* Amount BTC */
  table th:nth-child(5), table td:nth-child(5) { width: 20%; } /* Amount USD */
  
  th {
    background-color: #f2f2f2;
    font-weight: 600;
    color: var(--secondary-color);
  }
  
  tr:hover {
    background-color: rgba(247, 147, 26, 0.05);
  }
    
  .transaction-type {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.85rem;
  }
  
  .transaction-type.received {
    background-color: rgba(23, 162, 184, 0.15);
    color: var(--info-color);
  }
  
  .transaction-type.sent {
    background-color: rgba(220, 53, 69, 0.15);
    color: var(--danger-color);
  }
  
  /* Donation styles */
  .donation {
    margin-top: 10px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .btc-address {
    color: var(--primary-color);
    font-family: monospace;
    font-weight: 600;
    word-break: break-all;
  }
  
  .copy-notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--primary-color);
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    z-index: 1000;
  }
  
  .copy-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: background-color 0.2s;
  }
  
  .copy-btn:hover {
    background-color: #e68a00;
  }
    
  .loading {
    display: none;
    text-align: center;
    padding: 20px;
  }
  
  .spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top: 4px solid var(--primary-color);
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
    
  .error-message {
    color: var(--danger-color);
    background-color: rgba(220, 53, 69, 0.1);
    padding: 10px 15px;
    border-radius: 5px;
    margin-top: 10px;
    display: none;
  }
  
  .no-transactions {
    text-align: center;
    padding: 30px;
    color: var(--secondary-color);
  }
    
  @media (max-width: 768px) {
    .search-input {
      flex-direction: column;
    }
    
    .balance-cards {
      grid-template-columns: 1fr;
    }
    
    th, td {
      padding: 8px 10px;
      font-size: 0.9rem;
    }
    
    .container {
      padding: 10px;
    }
  }
  
  .site-footer {
    text-align: center;
    padding: 20px;
    margin-top: 30px;
    border-top: 1px solid var(--border-color);
    color: var(--secondary-color);
  }
  
  .heart-icon {
    color: var(--danger-color);
    animation: heartbeat 1.5s infinite;
  }
  
  @keyframes heartbeat {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  .site-footer {
    background-color: var(--card-bg);
    border-radius: 10px 10px 0 0;
    padding: 20px;
    text-align: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    margin-top: 30px;
  }
  
  .site-footer p {
    margin: 5px 0;
  }
  
  /* Styles for intro content */
  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 25px 0;
  }
  
  .feature-item {
    background-color: rgba(247, 147, 26, 0.05);
    border-radius: 8px;
    padding: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .feature-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  .feature-icon {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 15px;
  }
  
  .feature-item h3 {
    margin-top: 0;
    margin-bottom: 10px;
    color: var(--secondary-color);
  }
  
  .how-to-use {
    background-color: rgba(40, 167, 69, 0.05);
    border-radius: 8px;
    padding: 20px;
    margin: 25px 0;
  }
  
  .how-to-use h3 {
    margin-top: 0;
    color: var(--success-color);
  }
  
  .how-to-use ol {
    padding-left: 20px;
  }
  
  .how-to-use li {
    margin-bottom: 10px;
  }
  
  .bitcoin-info {
    background-color: rgba(23, 162, 184, 0.05);
    border-radius: 8px;
    padding: 20px;
    margin-top: 25px;
  }
  
  .bitcoin-info h3 {
    margin-top: 0;
    color: var(--info-color);
  }
  
  .bitcoin-info a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
  }
  
  .bitcoin-info a:hover {
    text-decoration: underline;
  }
  
  /* Hide intro content when results are shown */
  #results:not([style*="display: none"]) ~ #intro-content {
    display: none;
  }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fab fa-bitcoin"></i> Bitcoin Address Explorer</h1>
    </header>
    
    <div class="search-box">
      <div class="search-input">
        <input type="text" id="address" placeholder="Enter a Bitcoin address...">
        <button onclick="getBalance()"><i class="fas fa-search"></i> Check Balance</button>
      </div>
      <div id="errorMessage" class="error-message"></div>
    </div>
    
    <div id="intro-content" class="card">
      <h2><i class="fas fa-info-circle"></i> About Bitcoin Address Explorer</h2>
      <p>Welcome to Bitcoin Address Explorer, a powerful tool that allows you to check the balance and transaction history of any Bitcoin address on the blockchain.</p>
      
      <div class="features-grid">
        <div class="feature-item">
          <div class="feature-icon"><i class="fas fa-search"></i></div>
          <h3>Address Lookup</h3>
          <p>Enter any Bitcoin address to view its current balance, transaction history, and more.</p>
        </div>
        
        <div class="feature-item">
          <div class="feature-icon"><i class="fas fa-history"></i></div>
          <h3>Transaction History</h3>
          <p>View all incoming and outgoing transactions for any Bitcoin address with timestamps.</p>
        </div>
        
        <div class="feature-item">
          <div class="feature-icon"><i class="fas fa-dollar-sign"></i></div>
          <h3>USD Conversion</h3>
          <p>See the current USD value of all Bitcoin transactions and balances.</p>
        </div>
        
        <div class="feature-item">
          <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
          <h3>Privacy Focused</h3>
          <p>All lookups are performed client-side with no data storage or tracking.</p>
        </div>
      </div>
      
      <div class="how-to-use">
        <h3><i class="fas fa-question-circle"></i> How to Use</h3>
        <ol>
          <li>Enter a valid Bitcoin address in the search box above</li>
          <li>Click the "Check Balance" button or press Enter</li>
          <li>View the address balance and transaction history</li>
        </ol>
      </div>
      
      <div class="bitcoin-info">
        <h3><i class="fab fa-bitcoin"></i> What is Bitcoin?</h3>
        <p>Bitcoin is a decentralized digital currency that enables instant payments to anyone, anywhere in the world. Bitcoin uses peer-to-peer technology to operate with no central authority: transaction management and money issuance are carried out collectively by the network.</p>
        <p>Learn more about Bitcoin at <a href="https://bitcoin.org" target="_blank">bitcoin.org</a>.</p>
      </div>
    </div>
    
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Fetching blockchain data...</p>
    </div>
    
    <div id="results" style="display: none;">
      <div class="balance-cards">
        <div class="balance-card">
          <div class="icon received"><i class="fas fa-arrow-down"></i></div>
          <h2>Total Received</h2>
          <div id="totalReceived" class="amount received"></div>
          <div id="totalReceivedUsd" class="usd-amount"></div>
        </div>
        
        <div class="balance-card">
          <div class="icon sent"><i class="fas fa-arrow-up"></i></div>
          <h2>Total Sent</h2>
          <div id="totalSent" class="amount sent"></div>
          <div id="totalSentUsd" class="usd-amount"></div>
        </div>
        
        <div class="balance-card">
          <div class="icon balance"><i class="fas fa-wallet"></i></div>
          <h2>Final Balance</h2>
          <div id="finalBalance" class="amount balance"></div>
          <div id="finalBalanceUsd" class="usd-amount"></div>
        </div>
      </div>
      
      <div class="card transactions-section">
        <h2><i class="fas fa-exchange-alt"></i> Recent Transactions</h2>
        <div class="table-container">
          <table id="transactions">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Type</th>
                <th>Transaction ID</th>
                <th>Amount BTC</th>  
                <th>Amount USD</th>
              </tr>
            </thead>
            <tbody id="transactionsBody"></tbody>
          </table>
        </div>
        <div id="noTransactions" class="no-transactions" style="display: none;">
          <i class="fas fa-info-circle"></i> No transactions found for this address.
        </div>
      </div>
    </div>

  <script>
async function getBalance() {
  const input = document.getElementById("address").value.trim();
  
  if (!input) {
    showError("Please enter a Bitcoin address or transaction hash");
    return;
  }
      
  // Show loading indicator and hide previous results
  document.getElementById("loading").style.display = "block";
  document.getElementById("results").style.display = "none";
  document.getElementById("errorMessage").style.display = "none";
  document.getElementById("intro-content").style.display = "none";

  // Check if input is a transaction hash (64 hexadecimal characters)
  const isTransactionHash = /^[0-9a-fA-F]{64}$/.test(input);

  if (isTransactionHash) {
    await getTransactionDetails(input);
    return;
  }
      
      try {
    // Check internet connection first
    if (!navigator.onLine) {
      throw new Error("No internet connection. Please check your network and try again.");
    }
        
        // Get BTC price first - try multiple sources
        let btcToUsdRate;
        
        // Try CoinDesk API first
        try {
          const btcPriceUrl = 'https://api.coindesk.com/v1/bpi/currentprice/BTC.json';
          const btcPriceResponse = await fetch(btcPriceUrl, { timeout: 10000 });
          
          if (btcPriceResponse.ok) {
            const btcPriceData = await btcPriceResponse.json();
            btcToUsdRate = parseFloat(btcPriceData.bpi.USD.rate.replace(/,/g, ""));
            console.log('Successfully fetched BTC price from CoinDesk:', btcToUsdRate);
          } else {
            throw new Error(`Failed to fetch BTC price from CoinDesk: ${btcPriceResponse.status}`);
          }
        } catch (coinDeskError) {
          console.error('Error fetching BTC price from CoinDesk:', coinDeskError);
          
          // Try CoinGecko API as fallback
          try {
            const coingeckoUrl = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd';
            const coingeckoResponse = await fetch(coingeckoUrl, { timeout: 10000 });
            
            if (coingeckoResponse.ok) {
              const coingeckoData = await coingeckoResponse.json();
              btcToUsdRate = coingeckoData.bitcoin.usd;
              console.log('Successfully fetched BTC price from CoinGecko:', btcToUsdRate);
            } else {
              throw new Error(`Failed to fetch BTC price from CoinGecko: ${coingeckoResponse.status}`);
            }
          } catch (coingeckoError) {
            console.error('Error fetching BTC price from CoinGecko:', coingeckoError);
            
            // Try Binance API as a third option
            try {
              const binanceUrl = 'https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT';
              const binanceResponse = await fetch(binanceUrl, { timeout: 10000 });
              
              if (binanceResponse.ok) {
                const binanceData = await binanceResponse.json();
                btcToUsdRate = parseFloat(binanceData.price);
                console.log('Successfully fetched BTC price from Binance:', btcToUsdRate);
              } else {
                throw new Error(`Failed to fetch BTC price from Binance: ${binanceResponse.status}`);
              }
            } catch (binanceError) {
              console.error('Error fetching BTC price from all sources:', binanceError);
              // If all APIs fail, use a hardcoded approximate value as last resort
              btcToUsdRate = 50000; // Approximate value, will be updated on next successful API call
              console.warn('Using approximate BTC price:', btcToUsdRate);
              showError("Warning: Using approximate Bitcoin price. Actual values may differ.");
            }
          }
        }
        
        // Validate that we have a valid price
        if (!btcToUsdRate || isNaN(btcToUsdRate) || btcToUsdRate <= 0) {
          btcToUsdRate = 50000; // Fallback to approximate value
          console.warn('Invalid BTC price, using approximate value:', btcToUsdRate);
          showError("Warning: Using approximate Bitcoin price. Actual values may differ.");
        }
        
        // For SegWit addresses (starting with bc1), we need to use a different approach
        // First try to get address info from rawaddr endpoint
        try {
          const addrInfoUrl = `https://blockchain.info/rawaddr/${input}`;
          const addrInfoResponse = await fetch(addrInfoUrl, { timeout: 15000 });
          
          if (!addrInfoResponse.ok) {
            if (addrInfoResponse.status === 404) {
              showError("Invalid Bitcoin address or no data available.");
              document.getElementById("loading").style.display = "none";
              return;
            }
            throw new Error(`Failed to fetch address info: ${addrInfoResponse.status} ${addrInfoResponse.statusText}`);
          }
          
          const addrInfoData = await addrInfoResponse.json();
          
          if (addrInfoData && typeof addrInfoData.final_balance !== 'undefined') {
            // Calculate balances
            const totalReceived = addrInfoData.total_received / 100000000 || 0;
            const finalBalance = addrInfoData.final_balance / 100000000 || 0;
            const totalSent = addrInfoData.total_sent / 100000000 || 0;
            
            // Update balance display
            document.getElementById("totalReceived").innerText = totalReceived.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
            document.getElementById("totalReceivedUsd").innerText = "$" + (totalReceived * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
            
            document.getElementById("finalBalance").innerText = finalBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
            document.getElementById("finalBalanceUsd").innerText = "$" + (finalBalance * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
            
            document.getElementById("totalSent").innerText = totalSent.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
            document.getElementById("totalSentUsd").innerText = "$" + (totalSent * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
            
            // Get and display transactions
            await displayTransactions(input, btcToUsdRate, addrInfoData);
            
            // Show results
            document.getElementById("loading").style.display = "none";
            document.getElementById("results").style.display = "block";
            return;
          }
        } catch (addrInfoError) {
          console.error('Error fetching address info:', addrInfoError);
          // Only throw if it's not a 404 error (which we handle by continuing to fallback)
          if (addrInfoError.message && !addrInfoError.message.includes('404')) {
            throw addrInfoError;
          }
          // Continue with the fallback method
        }
        
        // Fallback to the balance API
        try {
          const balanceUrl = `https://blockchain.info/balance?active=${input}`;
          const balanceResponse = await fetch(balanceUrl, { timeout: 15000 });
          
          if (!balanceResponse.ok) {
            if (balanceResponse.status === 404) {
              showError("Invalid Bitcoin address or no data available.");
              document.getElementById("loading").style.display = "none";
              return;
            }
            throw new Error(`Failed to fetch balance: ${balanceResponse.status} ${balanceResponse.statusText}`);
          }
          
          const balanceData = await balanceResponse.json();

          if (!balanceData || !balanceData[input]) {
            showError("Invalid Bitcoin address or no data available.");
            document.getElementById("loading").style.display = "none";
            return;
          }

          // Calculate balances
          const totalReceived = balanceData[input].total_received / 100000000 || 0;
          const finalBalance = balanceData[input].final_balance / 100000000 || 0;
          const totalSent = totalReceived - finalBalance;

          // Update balance display
          document.getElementById("totalReceived").innerText = totalReceived.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
          document.getElementById("totalReceivedUsd").innerText = "$" + (totalReceived * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
          
          document.getElementById("finalBalance").innerText = finalBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
          document.getElementById("finalBalanceUsd").innerText = "$" + (finalBalance * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
          
          document.getElementById("totalSent").innerText = totalSent.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
          document.getElementById("totalSentUsd").innerText = "$" + (totalSent * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";

          // Get and display transactions
          await displayTransactions(input, btcToUsdRate);
          
          // Show results
          document.getElementById("loading").style.display = "none";
          document.getElementById("results").style.display = "block";
        } catch (balanceError) {
          console.error('Error fetching balance:', balanceError);
          throw balanceError;
        }
        
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || "An error occurred while fetching data. Please try again.");
        document.getElementById("loading").style.display = "none";
      }
    }
    
    async function getTransactionDetails(txHash) {
      try {
    // Check internet connection first
    if (!navigator.onLine) {
      throw new Error("No internet connection. Please check your network and try again.");
    }
        
        // Get BTC price first - try multiple sources
        let btcToUsdRate;
        
        // Try CoinDesk API first
        try {
          const btcPriceUrl = 'https://api.coindesk.com/v1/bpi/currentprice/BTC.json';
          const btcPriceResponse = await fetch(btcPriceUrl, { timeout: 10000 });
          
          if (btcPriceResponse.ok) {
            const btcPriceData = await btcPriceResponse.json();
            btcToUsdRate = parseFloat(btcPriceData.bpi.USD.rate.replace(/,/g, ""));
            console.log('Successfully fetched BTC price from CoinDesk:', btcToUsdRate);
          } else {
            throw new Error(`Failed to fetch BTC price from CoinDesk: ${btcPriceResponse.status}`);
          }
        } catch (coinDeskError) {
          console.error('Error fetching BTC price from CoinDesk:', coinDeskError);
          
          // Try CoinGecko API as fallback
          try {
            const coingeckoUrl = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd';
            const coingeckoResponse = await fetch(coingeckoUrl, { timeout: 10000 });
            
            if (coingeckoResponse.ok) {
              const coingeckoData = await coingeckoResponse.json();
              btcToUsdRate = coingeckoData.bitcoin.usd;
              console.log('Successfully fetched BTC price from CoinGecko:', btcToUsdRate);
            } else {
              throw new Error(`Failed to fetch BTC price from CoinGecko: ${coingeckoResponse.status}`);
            }
          } catch (coingeckoError) {
            console.error('Error fetching BTC price from CoinGecko:', coingeckoError);
            
            // Try Binance API as a third option
            try {
              const binanceUrl = 'https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT';
              const binanceResponse = await fetch(binanceUrl, { timeout: 10000 });
              
              if (binanceResponse.ok) {
                const binanceData = await binanceResponse.json();
                btcToUsdRate = parseFloat(binanceData.price);
                console.log('Successfully fetched BTC price from Binance:', btcToUsdRate);
              } else {
                throw new Error(`Failed to fetch BTC price from Binance: ${binanceResponse.status}`);
              }
            } catch (binanceError) {
              console.error('Error fetching BTC price from all sources:', binanceError);
              // If all APIs fail, use a hardcoded approximate value as last resort
              btcToUsdRate = 50000; // Approximate value, will be updated on next successful API call
              console.warn('Using approximate BTC price:', btcToUsdRate);
              showError("Warning: Using approximate Bitcoin price. Actual values may differ.");
            }
          }
        }
        
        // Validate that we have a valid price
        if (!btcToUsdRate || isNaN(btcToUsdRate) || btcToUsdRate <= 0) {
          btcToUsdRate = 50000; // Fallback to approximate value
          console.warn('Invalid BTC price, using approximate value:', btcToUsdRate);
          showError("Warning: Using approximate Bitcoin price. Actual values may differ.");
        }
        
        // Fetch transaction details
        const txUrl = `https://blockchain.info/rawtx/${txHash}`;
        const txResponse = await fetch(txUrl, { timeout: 15000 });
        
        if (!txResponse.ok) {
          if (txResponse.status === 404) {
            showError("Invalid transaction hash or no data available.");
            document.getElementById("loading").style.display = "none";
            return;
          }
          throw new Error(`Failed to fetch transaction details: ${txResponse.status} ${txResponse.statusText}`);
        }
        
        const txData = await txResponse.json();
        
        if (!txData || !txData.hash) {
          showError("Invalid transaction hash or no data available.");
          document.getElementById("loading").style.display = "none";
          return;
        }
        
        // Calculate total input and output values
        let totalInput = 0;
        let totalOutput = 0;
        
        if (txData.inputs && Array.isArray(txData.inputs)) {
          txData.inputs.forEach(input => {
            if (input.prev_out && typeof input.prev_out.value !== 'undefined') {
              totalInput += input.prev_out.value;
            }
          });
        }
        
        if (txData.out && Array.isArray(txData.out)) {
          txData.out.forEach(output => {
            if (typeof output.value !== 'undefined') {
              totalOutput += output.value;
            }
          });
        }
        
        // Convert satoshis to BTC
        const totalInputBTC = totalInput / 100000000;
        const totalOutputBTC = totalOutput / 100000000;
        const feeBTC = totalInputBTC - totalOutputBTC;
        
        // Update balance display with transaction details
        document.getElementById("totalReceived").innerText = totalInputBTC.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
        document.getElementById("totalReceivedUsd").innerText = "$" + (totalInputBTC * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
        
        document.getElementById("totalSent").innerText = totalOutputBTC.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC";
        document.getElementById("totalSentUsd").innerText = "$" + (totalOutputBTC * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
        
        document.getElementById("finalBalance").innerText = feeBTC.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 }) + " BTC (Fee)";
        document.getElementById("finalBalanceUsd").innerText = "$" + (feeBTC * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " USD";
        
        // Display transaction details
        const transactionsBody = document.getElementById("transactionsBody");
        transactionsBody.innerHTML = "";
        document.getElementById("noTransactions").style.display = "none";
        
        // Format date and time
        const txDate = new Date(txData.time * 1000);
        const formattedDate = txDate.toLocaleDateString() + ' ' + txDate.toLocaleTimeString();
        
        // Create a row for the transaction
        const row = document.createElement('tr');
        
        // Date & Time
        const dateCell = document.createElement('td');
        dateCell.textContent = formattedDate;
        row.appendChild(dateCell);
        
        // Transaction Type
        const typeCell = document.createElement('td');
        const typeSpan = document.createElement('span');
        typeSpan.className = 'transaction-type';
        typeSpan.textContent = 'Transaction';
        typeSpan.style.backgroundColor = 'rgba(247, 147, 26, 0.1)';
        typeSpan.style.color = '#f7931a';
        typeCell.appendChild(typeSpan);
        row.appendChild(typeCell);
        
        // Transaction ID
        const txIdCell = document.createElement('td');
        const txLink = document.createElement('a');
        txLink.href = `https://www.blockchain.com/btc/tx/${txData.hash}`;
        txLink.target = '_blank';
        txLink.textContent = txData.hash.substring(0, 10) + '...';
        txIdCell.appendChild(txLink);
        row.appendChild(txIdCell);
        
        // Fee Amount
        const btcCell = document.createElement('td');
        btcCell.textContent = `${feeBTC.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })} BTC (Fee)`;
        row.appendChild(btcCell);
        
        // USD Amount
        const usdCell = document.createElement('td');
        usdCell.textContent = `$${(feeBTC * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        row.appendChild(usdCell);
        
        transactionsBody.appendChild(row);
        
        // Add rows for inputs
        if (txData.inputs && txData.inputs.length > 0) {
          txData.inputs.forEach((input, index) => {
            if (input.prev_out && input.prev_out.addr) {
              const inputRow = document.createElement('tr');
              inputRow.style.backgroundColor = 'rgba(220, 53, 69, 0.05)';
              
              // Date & Time (empty for inputs)
              const dateCell = document.createElement('td');
              dateCell.textContent = '';
              inputRow.appendChild(dateCell);
              
              // Transaction Type
              const typeCell = document.createElement('td');
              const typeSpan = document.createElement('span');
              typeSpan.className = 'transaction-type sent';
              typeSpan.textContent = 'Input';
              typeCell.appendChild(typeSpan);
              inputRow.appendChild(typeCell);
              
              // Address
              const addrCell = document.createElement('td');
              const addrLink = document.createElement('a');
              addrLink.href = `https://www.blockchain.com/btc/address/${input.prev_out.addr}`;
              addrLink.target = '_blank';
              addrLink.textContent = input.prev_out.addr.substring(0, 10) + '...';
              addrCell.appendChild(addrLink);
              inputRow.appendChild(addrCell);
              
              // BTC Amount
              const btcAmount = (input.prev_out.value / 100000000) || 0;
              const btcCell = document.createElement('td');
              btcCell.className = 'sent';
              btcCell.textContent = `-${btcAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })} BTC`;
              inputRow.appendChild(btcCell);
              
              // USD Amount
              const usdCell = document.createElement('td');
              usdCell.textContent = `$${(btcAmount * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
              inputRow.appendChild(usdCell);
              
              transactionsBody.appendChild(inputRow);
            }
          });
        }
        
        // Add rows for outputs
        if (txData.out && txData.out.length > 0) {
          txData.out.forEach((output, index) => {
            if (output.addr) {
              const outputRow = document.createElement('tr');
              outputRow.style.backgroundColor = 'rgba(23, 162, 184, 0.05)';
              
              // Date & Time (empty for outputs)
              const dateCell = document.createElement('td');
              dateCell.textContent = '';
              outputRow.appendChild(dateCell);
              
              // Transaction Type
              const typeCell = document.createElement('td');
              const typeSpan = document.createElement('span');
              typeSpan.className = 'transaction-type received';
              typeSpan.textContent = 'Output';
              typeCell.appendChild(typeSpan);
              outputRow.appendChild(typeCell);
              
              // Address
              const addrCell = document.createElement('td');
              const addrLink = document.createElement('a');
              addrLink.href = `https://www.blockchain.com/btc/address/${output.addr}`;
              addrLink.target = '_blank';
              addrLink.textContent = output.addr.substring(0, 10) + '...';
              addrCell.appendChild(addrLink);
              outputRow.appendChild(addrCell);
              
              // BTC Amount
              const btcAmount = (output.value / 100000000) || 0;
              const btcCell = document.createElement('td');
              btcCell.className = 'received';
              btcCell.textContent = `+${btcAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })} BTC`;
              outputRow.appendChild(btcCell);
              
              // USD Amount
              const usdCell = document.createElement('td');
              usdCell.textContent = `$${(btcAmount * btcToUsdRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
              outputRow.appendChild(usdCell);
              
              transactionsBody.appendChild(outputRow);
            }
          });
        }
        
        // Show results
        document.getElementById("loading").style.display = "none";
        document.getElementById("results").style.display = "block";
        
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || "An error occurred while fetching transaction data. Please try again.");
        document.getElementById("loading").style.display = "none";
      }
    }

    async function displayTransactions(address, btcToUsdRate, existingData = null) {
      try {
        // Use existing data if provided, otherwise fetch it
        let data;
        if (existingData) {
          data = existingData;
        } else {
          try {
            const txUrl = `https://blockchain.info/rawaddr/${address}?limit=50`;
            const txResponse = await fetch(txUrl, { timeout: 15000 });
            
            if (!txResponse.ok) {
              throw new Error(`Failed to fetch transactions: ${txResponse.status} ${txResponse.statusText}`);
            }
            
            data = await txResponse.json();
          } catch (fetchError) {
            console.error('Error fetching transaction data:', fetchError);
            document.getElementById("noTransactions").style.display = "block";
            document.getElementById("noTransactions").innerHTML = 
              `<i class="fas fa-exclamation-circle"></i> Error loading transactions: ${fetchError.message || 'Please try again later.'}`;
            return;
          }
        }
        
        const transactionsBody = document.getElementById("transactionsBody");
        transactionsBody.innerHTML = "";
        
        if (!data || !data.txs || data.txs.length === 0) {
          document.getElementById("noTransactions").style.display = "block";
          return;
        }
        
        document.getElementById("noTransactions").style.display = "none";
        
        let transactionCount = 0;
        
        data.txs.forEach(tx => {
          try {
            // Skip invalid transaction objects
            if (!tx || !tx.hash || !tx.time) {
              console.warn('Invalid transaction object:', tx);
              return;
            }
            
            // Format date and time
            const txDate = new Date(tx.time * 1000);
            const formattedDate = txDate.toLocaleDateString() + ' ' + txDate.toLocaleTimeString();
            
            // Determine if this transaction is incoming or outgoing for this address
            let isIncoming = false;
            let relevantAmount = 0;
            
            // Check outputs for incoming transactions (money received by this address)
            if (tx.out && Array.isArray(tx.out)) {
              tx.out.forEach(output => {
                // Handle both standard addresses and SegWit (bech32) addresses
                if (output.addr === address || 
                    (output.scriptPubKey && output.scriptPubKey.addresses && 
                     Array.isArray(output.scriptPubKey.addresses) && 
                     output.scriptPubKey.addresses.includes(address))) {
                  isIncoming = true;
                  relevantAmount += output.value || 0;
                }
              });
            }
            
            // If not found in outputs, check inputs for outgoing transactions
            if (!isIncoming && tx.inputs && Array.isArray(tx.inputs)) {
              tx.inputs.forEach(input => {
                // Handle both standard addresses and SegWit (bech32) addresses
                if ((input.prev_out && input.prev_out.addr === address) || 
                    (input.prev_out && input.prev_out.scriptPubKey && 
                     input.prev_out.scriptPubKey.addresses && 
                     Array.isArray(input.prev_out.scriptPubKey.addresses) && 
                     input.prev_out.scriptPubKey.addresses.includes(address))) {
                  relevantAmount += (input.prev_out && input.prev_out.value) || 0;
                }
              });
            }
            
            // Skip transactions with zero amount (likely not related to this address)
            if (relevantAmount === 0) {
              return;
            }
            
            // Convert satoshis to BTC
            const btcAmount = relevantAmount / 100000000;
            const usdAmount = btcAmount * btcToUsdRate;
            
            // Create transaction row
            const row = document.createElement('tr');
            
            // Date & Time
            const dateCell = document.createElement('td');
            dateCell.textContent = formattedDate;
            row.appendChild(dateCell);
            
            // Transaction Type
            const typeCell = document.createElement('td');
            const typeSpan = document.createElement('span');
            typeSpan.className = `transaction-type ${isIncoming ? 'received' : 'sent'}`;
            typeSpan.textContent = isIncoming ? 'Received' : 'Sent';
            typeCell.appendChild(typeSpan);
            row.appendChild(typeCell);
            
            // Transaction ID (shortened with link)
            const txIdCell = document.createElement('td');
            const txLink = document.createElement('a');
            txLink.href = `https://www.blockchain.com/btc/tx/${tx.hash}`;
            txLink.target = '_blank';
            txLink.textContent = tx.hash.substring(0, 10) + '...';
            txIdCell.appendChild(txLink);
            row.appendChild(txIdCell);
            
            // BTC Amount
            const btcCell = document.createElement('td');
            btcCell.className = isIncoming ? 'received' : 'sent';
            btcCell.textContent = `${isIncoming ? '+' : '-'}${btcAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 })} BTC`;
            row.appendChild(btcCell);
            
            // USD Amount
            const usdCell = document.createElement('td');
            usdCell.textContent = `$${usdAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            row.appendChild(usdCell);
            
            transactionsBody.appendChild(row);
            transactionCount++;
          } catch (txError) {
            console.error('Error processing transaction:', txError, tx);
            // Continue with next transaction
          }
        });
        
        // If no transactions were added to the table
        if (transactionCount === 0) {
          document.getElementById("noTransactions").style.display = "block";
        }
        
      } catch (error) {
        console.error('Error displaying transactions:', error);
        document.getElementById("noTransactions").style.display = "block";
        document.getElementById("noTransactions").innerHTML = 
          `<i class="fas fa-exclamation-circle"></i> Error loading transactions: ${error.message || 'Please try again later.'}`;
      }
    }
    
    function showError(message) {
      const errorElement = document.getElementById("errorMessage");
      errorElement.textContent = message;
      errorElement.style.display = "block";
      
      // Hide loading indicator
      document.getElementById("loading").style.display = "none";
      
      // Show intro content if results are not displayed
      if (document.getElementById("results").style.display === "none") {
        document.getElementById("intro-content").style.display = "block";
      }
    }
    
    // Add event listener for Enter key in the address input
    document.getElementById("address").addEventListener("keyup", function(event) {
      if (event.key === "Enter") {
        getBalance();
      }
    });
  </script>

  <footer class="site-footer">
    <p>Made with <i class="fas fa-heart heart-icon"></i> for Bitcoin enthusiasts | &copy; 2025 Bitcoin Checker</p>
    <p class="donation">Donation BTC address wallet: <span class="btc-address">bc1quhsqgufun9fnqr8e4ntexg6q4gv62kmknyc97l</span> <button class="copy-btn" onclick="copyToClipboard('bc1quhsqgufun9fnqr8e4ntexg6q4gv62kmknyc97l')"><i class="fas fa-copy"></i></button></p>
    <div id="copy-notification" class="copy-notification">BTC wallet address copied!</div>
  </footer>
  
  <script>
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const notification = document.getElementById('copy-notification');
        notification.style.opacity = '1';
        
        // Automatically hide notification after 3 seconds
        setTimeout(() => {
          notification.style.opacity = '0';
        }, 3000);
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
  </script>

</body>
</html>
